---
title: "Daily Hormone Plots"
author: "Anisha Nagpal"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(pdftools)
library(magick)
```

- people to omit based on Tory's review 
  - 125
  - 104
  - 155
  - 182 

161 exclude final pos ov test 
158 and 164 are fine, LH peaks on date of pos ov tests 
  
- Notes on date terms: 
  - daterated = actual date of outcome data, date of surveys, date that the hormone levels correspond to (datemarked-1)
  - date_marked - date of urine strip collection 


```{r}
dat <- read_csv("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/BEARS/02_datasets/BEARS_DAILY/03_cleaned_data/bearsdaily20240708_clean.csv")

dat <- dat %>% select(ID, Survey_Submitted_Date, date_use, date_marked, date_uncertain, strip_num, wet, LH, E1G, PDG, E1G_Crtn, PDG_Crtn, LH_Crtn, undet_LH, undet_E1G, undet_PDG, low_crtn, high_crtn, validity_concern, mensdayone, mensdayonefirst, LHposday, LHposdayfirst, cycleday, daycountLH, hybridcycleday, starts_with("PM_phys"))

dat$E1G_Crtn_100 = dat$E1G_Crtn * 100

dat$LH_Crtn_100 = dat$LH_Crtn * 100

hybridcycleday_order <- c("-7L",
                       "-6L",
                       "-5L",
                       "-4L",
                       "-3L",
                       "-2L",
                       "-1L",
                       "0L",
                       "1L",
                       "2L",
                       "3L",
                       "4L",
                       "5L",
                       "-9M",
                       "-8M",
                       "-7M",
                       "-6M",
                       "-5M",
                       "-4M",
                       "-3M",
                       "-2M",
                       "-1M",
                       "1M",
                       "2M",
                       "3M",
                       "4M",
                       "5M",
                       "6M",
                       "7M")

dat %>% filter(ID == 143) %>% select(ID, date_marked, date_use, Survey_Submitted_Date, mensdayonefirst)

dat <- dat %>%
  mutate(date_marked = as.POSIXct(dat$date_marked, format = "%Y/%m/%d")) %>%
  mutate(date_marked = as.Date(date_marked)) %>%
  mutate(date_use = as.POSIXct(dat$date_use, format = "%Y/%m/%d")) %>%         
  mutate(date_use = as.Date(date_use)) %>%
  mutate(Survey_Submitted_Date = as.Date(Survey_Submitted_Date, format = "%Y-%m-%d")) 

dat <- dat %>%
  arrange(ID, date_marked)

dat <- dat %>%
  filter(!(is.na(date_use) & is.na(Survey_Submitted_Date) & is.na(date_marked)))

dat <- dat %>%
  mutate(date_use = case_when(
    is.na(date_use) ~ Survey_Submitted_Date,
    TRUE ~ date_use
  ))

dat <- dat %>%
  mutate(date_use = case_when(
    is.na(date_use) ~ date_marked,
    TRUE ~ date_use
  ))
 
dat <- dat %>% group_by(ID) %>%
  complete(date_use = seq.Date(min(date_use), max(date_use), by = "day"))

dat <- dat %>%
  group_by(ID, date_use) %>%
  slice(1) %>%
  ungroup()

#df = dat 

#df <- df %>% select(ID, date_use, LH, E1G, PDG, E1G_Crtn, PDG_Crtn, LH_Crtn)

#dat <- dat %>% select(-c(LH, E1G, PDG, E1G_Crtn, PDG_Crtn, LH_Crtn))

# df <- df %>% 
#   arrange(ID, date_use) %>%
#   group_by(ID) %>%
#   mutate(daterated = date_use - 1)
# 
# dat$daterated = dat$date_use 
# 
# dat = full_join(dat, df, by = c("ID", "daterated"))
# dat <- dat %>% select(-c(date_use.x, date_use.y))
# 
# saveRDS(dat, "C:/Users/Student/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/REVIEW_cycleday_modeling/02_analytic_workspace/07_16_24_bearsdailydaterated.rds")
```

```{r}
# dat <- readRDS("C:/Users/Student/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/REVIEW_cycleday_modeling/02_analytic_workspace/07_16_24_bearsdailydaterated.rds")

dat$date_marked <- dplyr::case_when(
  is.na(dat$date_marked) ~ dat$date_use,
  TRUE ~ dat$date_marked)

dat.long = pivot_longer(dat, cols = c("LH_Crtn_100", "E1G_Crtn_100", "PDG_Crtn"), names_to = "hormone", values_to = "value")
```






```{r}
dat.long <- dat.long %>%
  mutate(mensesdate = case_when(
    mensdayonefirst == 1 ~ date_marked,
    TRUE ~ NA
  ))

dat.long <- dat.long %>%
  mutate(LHposdate = case_when(
    LHposdayfirst == 1 ~ date_marked,
    TRUE ~ NA
  ))

dat.long$date_marked  <- as.POSIXct(dat.long$date_marked, format = "%Y/%m/%d")

saveRDS(dat, "~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/REVIEW_cycleday_modeling/02_analytic_workspace/01_27_25_bearsdailydatemarked.rds")

```

plotting with daterated, which lags all of the hormones one day. Complete plots 

```{r fig.dim = c(12, 7)}
# ID_182_plot <- dat.long %>% filter(ID == 182) %>%
#   #filter(complete.cases(daterated, value)) %>%
#   select(ID, daterated, hormone, value, mensesdate, LHposdate) %>%
#    mutate(
#     daterated = as.POSIXct(daterated, format = "%Y-%m-%d %H:%M:%S"),
#     mensesdate = as.POSIXct(mensesdate, format = "%Y-%m-%d %H:%M:%S"),
#     LHposdate = as.POSIXct(LHposdate, format = "%Y-%m-%d %H:%M:%S")
#   ) %>%
#   ggplot() + 
#   geom_line(aes(x = daterated, y = value, color = hormone, group = hormone), linewidth = 0.7)+
#   geom_vline(data = . %>% filter(!is.na(mensesdate)), aes(xintercept = mensesdate), color = "red", linewidth = 1) +
#   geom_vline(data = . %>% filter(!is.na(LHposdate)), aes(xintercept = LHposdate), color = "purple", linewidth = 1) +
#   geom_point(aes(x = daterated, y = value, color = hormone, group = hormone))+
#   scale_x_datetime(date_breaks = "1 day")+
#   theme_light()+
#   theme(axis.text.x = element_text(size = 6.2, angle = 90, hjust = 1))
#   
# ID_182_plot

#dat.long %>% filter(ID == 102) %>% select(ID, daterated, hormone, value, mensesdate, LHposdate) 
```

# raw data plots- full plots (not complete cases)

```{r}
# ids <- c(102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 127, 128, 129, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 142, 143, 144, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 171, 173, 174, 175, 176, 178, 179, 180, 182, 183, 184, 185)
# 
# for (i in ids){
#   plots <- list()
#   plot <- dat.long %>% filter(ID == i) %>%
#   #filter(complete.cases(daterated, value)) %>%
#   mutate(
#    daterated = as.POSIXct(daterated, format = "%Y-%m-%d %H:%M:%S"),
#    mensesdate = as.POSIXct(mensesdate, format = "%Y-%m-%d %H:%M:%S"),
#    LHposdate = as.POSIXct(LHposdate, format = "%Y-%m-%d %H:%M:%S")
#   ) %>%
#   ggplot() + 
#   geom_line(aes(x = daterated, y = value, color = hormone, group = hormone), linewidth = 0.7)+
#   geom_vline(data = . %>% filter(!is.na(mensesdate)), aes(xintercept = mensesdate), color = "red", linewidth = 1) +
#   geom_vline(data = . %>% filter(!is.na(LHposdate)), aes(xintercept = LHposdate), color = "purple", linewidth = 1) +
#   geom_point(aes(x = daterated, y = value, color = hormone, group = hormone))+
#   scale_x_datetime(date_breaks = "1 day")+
#   theme_light()+
#   theme(axis.text.x = element_text(size = 7.5, angle = 90, hjust = 1)) +
#   ggtitle(i, subtitle = "red line = menses onset, purple line = posLH test")
#   
#   plots[[i]] <- plot
# 
#   print(plot)
# 
#    BEARS_daily_horm_plots_ <- paste0("C:/Users/Student/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/BEARS/02_datasets/BEARS_DAILY/02_data_prep_workspace/daily_hormone_plots_RAW_81224/daterated_full/daily_hormone_plot_", i, ".png")
#    ggsave(BEARS_daily_horm_plots_, plot, width = 10, height = 6, dpi = 300)
# }
# 
# dat.long %>% filter(ID == 143) %>% select(ID, date_marked, daterated, mensdayonefirst, mensesdate)
# 
# setwd("C:/Users/Student/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/BEARS/02_datasets/BEARS_DAILY/02_data_prep_workspace/daily_hormone_plots_RAW_81224/daterated_full")
# 
# png_files <- list.files(pattern = "\\.png$")
# # Read the images using magick
# images <- image_read(png_files)
# # Combine the images into a single PDF
# image_write(images, path = "combined_daily_plots_daterated_81224.pdf", format = "pdf")
```

# raw data plots- complete cases only 

```{r}
# ids <- c(102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 127, 128, 129, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 142, 143, 144, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 171, 173, 174, 175, 176, 178, 179, 180, 182, 183, 184, 185)
# 
# for (i in ids){
#   plots <- list()
#   plot <- dat.long %>% filter(ID == i) %>%
#   filter(complete.cases(daterated, value)) %>%
#   mutate(
#    daterated = as.POSIXct(daterated, format = "%Y-%m-%d %H:%M:%S"),
#    mensesdate = as.POSIXct(mensesdate, format = "%Y-%m-%d %H:%M:%S"),
#    LHposdate = as.POSIXct(LHposdate, format = "%Y-%m-%d %H:%M:%S")
#   ) %>%
#   ggplot() + 
#   geom_line(aes(x = daterated, y = value, color = hormone, group = hormone), linewidth = 0.7)+
#   geom_vline(data = . %>% filter(!is.na(mensesdate)), aes(xintercept = mensesdate), color = "red", linewidth = 1) +
#   geom_vline(data = . %>% filter(!is.na(LHposdate)), aes(xintercept = LHposdate), color = "purple", linewidth = 1) +
#   geom_point(aes(x = daterated, y = value, color = hormone, group = hormone))+
#   scale_x_datetime(date_breaks = "1 day")+
#   theme_light()+
#   theme(axis.text.x = element_text(size = 7.5, angle = 90, hjust = 1)) +
#   ggtitle(i, subtitle = "red line = menses onset, purple line = posLH test")
#   
#   plots[[i]] <- plot
# 
#   print(plot)
# 
#    BEARS_daily_horm_plots_ <- paste0("C:/Users/Student/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/BEARS/02_datasets/BEARS_DAILY/02_data_prep_workspace/daily_hormone_plots_RAW_81224/daterated_complete_cases/daily_hormone_plot_", i, ".png")
#    ggsave(BEARS_daily_horm_plots_, plot, width = 10, height = 6, dpi = 300)
# }
# 
# dat.long %>% filter(ID == 143) %>% select(ID, date_marked, daterated, mensdayonefirst, mensesdate)


```

# z-scoring 

```{r}

dat <- dat %>%
  group_by(ID) %>%
  mutate(LH_Crtn_z = scale(LH_Crtn)) %>%
  ungroup()

dat <- dat %>%
  group_by(ID) %>%
  mutate(E1G_Crtn_z = scale(E1G_Crtn)) %>%
  ungroup()

dat <- dat %>%
  group_by(ID) %>%
  mutate(PDG_Crtn_z = scale(PDG_Crtn)) %>%
  ungroup()

dat.long.z = pivot_longer(dat, cols = c("LH_Crtn_z", "E1G_Crtn_z", "PDG_Crtn_z"), names_to = "hormone", values_to = "value")


dat.long.z$date_marked = as.Date(dat.long.z$date_marked)
dat.long.z$date_marked  <- as.POSIXct(dat.long.z$date_marked, format = "%Y/%m/%d")

#remove IDs where hormone data is completely NA

dat.long.z <- dat.long.z %>%
  mutate(mensesdate = case_when(
    mensdayonefirst == 1 ~ date_marked,
    TRUE ~ NA
  ))

dat.long.z <- dat.long.z %>%
  mutate(LHposdate = case_when(
    LHposdayfirst == 1 ~ date_marked,
    TRUE ~ NA
  ))

```

# z-scored plots 

```{r}
setwd("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/BEARS/02_datasets/BEARS_DAILY/02_data_prep_workspace/daily_hormone_plots_zscored_01172025")

ids <- c(102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 127, 128, 129, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 142, 143, 144, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 171, 173, 174, 175, 176, 178, 179, 180, 182, 183, 184, 185)

for (i in ids){
  plots <- list()
  plot <- dat.long.z %>% filter(ID == i) %>%
  filter(complete.cases(date_marked, value)) %>%
   mutate(
    date_marked = as.POSIXct(date_marked, format = "%Y-%m-%d %H:%M:%S"),
    mensesdate = as.POSIXct(mensesdate, format = "%Y-%m-%d %H:%M:%S"),
    LHposdate = as.POSIXct(LHposdate, format = "%Y-%m-%d %H:%M:%S")
  ) %>%
  ggplot() + 
  geom_line(aes(x = date_marked, y = value, color = hormone, group = hormone), linewidth = 0.7)+
  geom_vline(data = . %>% filter(!is.na(mensesdate)), aes(xintercept = mensesdate), color = "red", linewidth = 1) +
  geom_vline(data = . %>% filter(!is.na(LHposdate)), aes(xintercept = LHposdate), color = "purple", linewidth = 1) +
  geom_point(aes(x = date_marked, y = value, color = hormone, group = hormone))+
  scale_x_datetime(date_breaks = "1 day")+
  theme_light()+
  theme(axis.text.x = element_text(size = 7.5, angle = 90, hjust = 1)) +
  ggtitle(i, subtitle = "red line = menses onset, purple line = posLH test")
  
  plots[[i]] <- plot

  print(plot)
  
  BEARS_daily_horm_plots_ <- paste0("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/BEARS/02_datasets/BEARS_DAILY/02_data_prep_workspace/daily_hormone_plots_zscored_01172025/daily_hormone_plot_z_", i, ".png")
  ggsave(BEARS_daily_horm_plots_, plot, width = 10, height = 6, dpi = 300)
}



png_files <- list.files(pattern = "\\.png$")
# Read the images using magick
images <- image_read(png_files)
# Combine the images into a single PDF
image_write(images, path = "comb_daily_hormone_plots.pdf", format = "pdf")
```

```{r}
dat %>% filter(ID == 180)
```





# spag plot E1G, counting method 

## menses-centered, z-scored E1G



```{r}
dat.long.E1Gz <- dat.long.z %>% filter(hormone == "E1G_Crtn_z") 
dat.long.E1Gz <- dat.long.E1Gz[complete.cases(dat.long.E1Gz [c("cycleday_plot", "value")]),]
dat.long.E1Gz %>% select(ID, cycleday_plot, value)


ggplot(dat.long.E1Gz, aes(x = cycleday_plot, y = value, group = factor(ID), color = factor(ID)))+
   geom_rect(xmin = -0.5, xmax = 0.5, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(xmin = -15, xmax = -14, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=0, y=3.8, label="Menses Onset",
              color="black")+
  annotate(geom="text", x=-14, y=3.8, label="Ovulation",
            color="black")+
  geom_point(size = 0.2) +
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") + 
    scale_x_continuous(limits = c(-15, 12), breaks = seq(-15 ,12, by = 1), labels=c("-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13"))+
   xlab("Cycle Day (Menses Count)") + 
    ylab("z-scored E1G") +
  theme_light()
```
## ovulation-centered, z-scored E1G

```{r}
ggplot(dat.long.E1Gz, aes(x = cycleday_ov, y = value, group = factor(ID), color = factor(ID)))+
   geom_rect(xmin = 0, xmax = 1, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(xmin = 13, xmax = 14, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=13.5, y=4, label="Ovulation",
              color="black")+
  annotate(geom="text", x=1.75, y=4, label="Menses Onset",
            color="black")+
   geom_point(size = .7) + 
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") +
    scale_x_continuous(limits = c(0, 27), breaks = seq(0 ,27, by = 1), labels=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12","13", "-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1" )) +
   xlab("Cycle Day (Menses Count)") + 
    ylab("z-scored E1G") +
  theme_light()
```
## menses-centered E1G.d

```{r}
dat.long.E1G.d = pivot_longer(dat, cols = c("E1G_Crtn.d"), names_to = "hormone", values_to = "value")

dat.long.E1G.d <- dat.long.E1G.d[complete.cases(dat.long.E1G.d [c("cycleday_plot", "value")]),]

dat.long.E1G.d %>% select(ID, cycleday_plot, value)
dat.long.E1G.d <- dat.long.E1G.d %>% filter(ID!= 125)
dat.long.E1G.d <- dat.long.E1G.d %>% filter(ID!= 104)

ggplot(dat.long.E1G.d, aes(x = cycleday_plot, y = value, group = factor(ID), color = factor(ID)))+
   geom_rect(xmin = -0.5, xmax = 0.5, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(xmin = -15, xmax = -14, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=0, y=125, label="Menses Onset",
              color="black")+
  annotate(geom="text", x=-14, y=125, label="Ovulation",
            color="black")+
  geom_point(size = 0.2) +
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") + 
   scale_x_continuous(limits = c(-15, 12), breaks = seq(-15 ,12, by = 1), labels=c("-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13"))+
   xlab("Cycle Day (Menses Count)") + 
    ylab("E1G Person-centered") +
  theme_light()
```

## ovulation-centered E1G.d


```{r}

dat.long.E1G.ov.d = pivot_longer(dat, cols = c("E1G_Crtn.d"), names_to = "hormone", values_to = "value")

dat.long.E1G.ov.d <- dat.long.E1G.ov.d[complete.cases(dat.long.E1G.ov.d [c("cycleday_ov", "value")]),]

dat.long.E1G.ov.d %>% select(ID, cycleday_ov, value)
dat.long.E1G.ov.d <- dat.long.E1G.ov.d %>% filter(ID!= 125)
dat.long.E1G.ov.d <- dat.long.E1G.ov.d %>% filter(ID!= 104)

ggplot(dat.long.E1G.ov.d, aes(x = cycleday_ov, y = value, group = factor(ID), color = factor(ID)))+
    geom_rect(xmin = 0, xmax = 1, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(xmin = 13, xmax = 14, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=13.5, y=125, label="Ovulation",
              color="black")+
  annotate(geom="text", x=1.75, y=125, label="Menses Onset",
            color="black")+
   geom_point(size = .7) + 
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") +
    scale_x_continuous(limits = c(0, 27), breaks = seq(0 ,27, by = 1), labels=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12","13", "-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1" )) +
   xlab("Cycle Day (Menses Count)") + 
    ylab("E1G Person-Centered") +
  theme_light()
```


# spag plot PDG, counting method 

## menses-centered, z-scored

```{r}
dat.long.PDGz <- dat.long.z %>% filter(hormone == "PDG_Crtn_z") 

dat.long.PDGz <- dat.long.PDGz[complete.cases(dat.long.PDGz [c("cycleday_plot", "value")]),]

dat.long.PDGz %>% select(ID, cycleday, value)
dat.long.PDGz <- dat.long.PDGz %>% filter(ID!= 125)
dat.long.PDGz <- dat.long.PDGz %>% filter(ID!= 104)

ggplot(dat.long.PDGz, aes(x = cycleday_plot, y = value, group = factor(ID), color = factor(ID)))+
     geom_rect(xmin = -0.5, xmax = 0.5, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(xmin = -15, xmax = -14, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=0, y=3.8, label="Menses Onset",
              color="black")+
  annotate(geom="text", x=-14, y=3.8, label="Ovulation",
            color="black")+
  geom_point(size = 0.2) +
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") + 
    scale_x_continuous(limits = c(-15, 12), breaks = seq(-15 ,12, by = 1), labels=c("-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13"))+
  xlab("Cycle Day (Menses Count)") + 
    ylab("z-scored PDG") +
  theme_light()
```

## ovulation-centered, z-scored

```{r}
ggplot(dat.long.PDGz, aes(x = cycleday_ov, y = value, group = factor(ID), color = factor(ID)))+
    geom_rect(xmin = 0, xmax = 1, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(xmin = 13, xmax = 14, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=13.5, y=4, label="Ovulation",
              color="black")+
  annotate(geom="text", x=1.75, y=4, label="Menses Onset",
            color="black")+
   geom_point(size = .7) + 
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") +
    scale_x_continuous(limits = c(0, 27), breaks = seq(0 ,27, by = 1), labels=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12","13", "-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1" )) +
   xlab("Cycle Day (Menses Count)") + 
    ylab("z-scored PDG") +
  theme_light()
```

## menses-centered PDG.d

```{r}
dat.long.PDG.d = pivot_longer(dat, cols = c("PDG_Crtn.d"), names_to = "hormone", values_to = "value")

dat.long.PDG.d <- dat.long.PDG.d[complete.cases(dat.long.PDG.d [c("cycleday_plot", "value")]),]

dat.long.PDG.d %>% select(ID, cycleday_plot, value)
dat.long.PDG.d <- dat.long.PDG.d %>% filter(ID!= 125)
dat.long.PDG.d <- dat.long.PDG.d %>% filter(ID!= 104)

ggplot(dat.long.PDG.d, aes(x = cycleday_plot, y = value, group = factor(ID), color = factor(ID)))+
   geom_rect(xmin = -0.5, xmax = 0.5, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(xmin = -15, xmax = -14, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=0, y=10100, label="Menses Onset",
              color="black")+
  annotate(geom="text", x=-14, y=10100, label="Ovulation",
            color="black")+
  geom_point(size = 0.2) +
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") + 
   scale_x_continuous(limits = c(-15, 12), breaks = seq(-15 ,12, by = 1), labels=c("-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13"))+
   xlab("Cycle Day (Menses Count)") + 
    ylab("PDG Person-centered") +
  theme_light()
```

## ovulation-centered PDG.d

```{r}

dat.long.PDG.ov.d = pivot_longer(dat, cols = c("PDG_Crtn.d"), names_to = "hormone", values_to = "value")

dat.long.PDG.ov.d <- dat.long.PDG.ov.d[complete.cases(dat.long.PDG.ov.d [c("cycleday_ov", "value")]),]
dat.long.PDG.ov.d <- dat.long.PDG.ov.d %>% filter(ID!= 125)
dat.long.PDG.ov.d <- dat.long.PDG.ov.d %>% filter(ID!= 104)
dat.long.PDG.ov.d %>% select(ID, cycleday_ov, value)

ggplot(dat.long.PDG.ov.d, aes(x = cycleday_ov, y = value, group = factor(ID), color = factor(ID)))+
  geom_rect(xmin = 0, xmax = 1, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(xmin = 13, xmax = 14, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=13.5, y=10100, label="Ovulation",
              color="black")+
  annotate(geom="text", x=1.75, y=10100, label="Menses Onset",
            color="black")+
   geom_point(size = .7) + 
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") +
    scale_x_continuous(limits = c(0, 27), breaks = seq(0 ,27, by = 1), labels=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12","13", "-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1" )) +
   xlab("Cycle Day (Menses Count)") + 
    ylab("PDG Person-Centered") +
  theme_light()
```


# spag plot E1G hybrid count


```{r}

  dat.long.E1Gz %>%
  filter(!is.na(hybridcycleday_DR) & !is.na(value)) %>%
ggplot(aes(x= factor(hybridcycleday_DR, levels = hybridcycleday_order), y = value, group = factor(ID), color = factor(ID)))+
   geom_rect(xmin = 22.5, xmax = 23.5 , ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(xmin = 8.5, xmax = 9.5, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=23, y=3.8, label="Menses Onset",
              color="black")+
  annotate(geom="text", x=9, y=3.8, label="Ovulation",
            color="black")+
  geom_point(size = 0.2) +
  geom_line(size = 0.2) +
  scale_color_discrete(name = "ID") + 
   xlab("Cycle Day") + 
    ylab("z-scored E1G") +
  theme_light()

```


# spag plot PDG hybrid count 

```{r}
dat.long.PDGz %>%
  filter(!is.na(hybridcycleday_DR) & !is.na(value)) %>%
ggplot(aes(x= factor(hybridcycleday_DR, levels =hybridcycleday_order), y = value, group = factor(ID), color = factor(ID)))+
   geom_rect(xmin = 22.5, xmax = 23.5 , ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(xmin = 8.5, xmax = 9.5, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=23, y=4.5, label="Menses Onset",
              color="black")+
  annotate(geom="text", x=9, y=4.5, label="Ovulation",
            color="black")+
  geom_point(size = 1) +
  geom_line(size = 0.7) +
  scale_color_discrete(name = "ID") + 
   xlab("Cycle Day (Menses Count)") + 
    ylab("z-scored PDG") +
  theme_light()
```

# Adjusted LH Peaks 


```{r}
d1 <- read.csv("C:/Users/Student/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/BEARS/02_datasets/BEARS_DAILY/02_data_prep_workspace/daily_hormone_plot_review_taem.csv")
d1 <- d1 %>% select(ID, LH_confirm_DR)
d1$LH_confirm_DR <- mdy(d1$LH_confirm_DR)

dat <- dat %>%
  rowwise() %>%
  mutate(LH_confirm = case_when(
    any(d1$ID == ID & d1$LH_confirm_DR == daterated) ~ 1,
    TRUE ~ 0
  )) %>%
  ungroup()

dat %>% filter(ID == 119) %>% select(ID, daterated, LH_confirm)

dat <- dat %>% arrange(ID, daterated) %>%
  group_by(ID) %>%
  mutate(ov_est = lag(LH_confirm))

dat %>% select(ID, daterated, LH_confirm, ov_est, mensdayonefirst)
```


# person-standardized plot, scaled_cycleday, menses-centered 

```{r}
dat.long.sc = pivot_longer(dat, cols = c("E1G_Crtn_z.d", "PDG_Crtn_z.d", "LH_Crtn_z.d"), names_to = "hormone", values_to = "value")

dat.long.sc <- dat.long.sc %>% 
  group_by(cycleday_5perc, hormone) %>% 
  summarise(mean_dev = mean(value, na.rm = T)) 

ggplot(dat.long.sc, aes(x = cycleday_5perc, y = mean_dev, group = hormone, color = hormone, )) +
   scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.25), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) + 
  geom_rect(aes(xmin = 0.47, xmax = 0.53, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_line(size = 1) +
  geom_point(size = 1) +
  labs(x = "", y = "Person Standardized") + 
 theme_minimal() 
    

```

# person-standardized plot, scaled_cycleday_imputed, menses-centered 

```{r}
dat.long.sc.imp = pivot_longer(dat, cols = c("E1G_Crtn_z.d", "PDG_Crtn_z.d", "LH_Crtn_z.d"), names_to = "hormone", values_to = "value")

dat.long.sc.imp <- dat.long.sc.imp %>% 
  group_by(cycleday_5perc_imp, hormone) %>% 
  summarise(mean_dev = mean(value, na.rm = T))

ggplot(dat.long.sc.imp, aes(x = cycleday_5perc_imp, y = mean_dev, group = hormone, color = hormone, )) +
   scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.25), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) + 
  geom_rect(aes(xmin = 0.47, xmax = 0.53, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_line(size = 1) +
  geom_point(size = 1) +
  labs(x = "", y = "Person Standardized") + 
 theme_minimal() 
```



# person-standardized plot, scaled_cycleday, ovulation-centered 

```{r}
dat.long.sc.ov = pivot_longer(dat, cols = c("E1G_Crtn_z.d", "PDG_Crtn_z.d", "LH_Crtn_z.d"), names_to = "hormone", values_to = "value")

meanov <- dat %>% filter(ov_est == 1)%>% select(cycledayov_5perc)

dat.long.sc.ov <- dat.long.sc.ov %>% 
  group_by(cycledayov_5perc, hormone) %>% 
  summarise(mean_dev = mean(value, na.rm = T), sd_dev = sd(value, na.rm = T))

ggplot(dat.long.sc.ov, aes(x = cycledayov_5perc, y = mean_dev, group = hormone, color = hormone, )) +
   scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.25), labels = c("0%F", "50%F", "Ovulation", "50%L", "Menses Onset")) + 
  geom_rect(aes(xmin = 0.43, xmax = 0.49, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.94, xmax = 1, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_line(size = 1) +
  geom_point(size = 1) +
  labs(x = "", y = "Person Standardized") + 
 theme_minimal() 
```
# person-standardized plot, scaled_cycledayov_imp, ovulation-centered 

```{r}
dat.long.sc.ov.imp = pivot_longer(dat, cols = c("E1G_Crtn_z.d", "PDG_Crtn_z.d", "LH_Crtn_z.d"), names_to = "hormone", values_to = "value")

#meanov <- dat %>% filter(ov_est == 1) %>% select(cycledayov_5perc_imp)

dat.long.sc.ov.imp <- dat.long.sc.ov.imp %>% 
  group_by(cycledayov_5perc_imp, hormone) %>% 
  summarise(mean_dev = mean(value, na.rm = T))

ggplot(dat.long.sc.ov.imp, aes(x = cycledayov_5perc_imp, y = mean_dev, group = hormone, color = hormone, )) +
   scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.25), labels = c("0%F", "50%F", "Ovulation", "50%L", "Menses Onset")) + 
  geom_rect(aes(xmin = 0.43, xmax = 0.49, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.94, xmax = 1, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_line(size = 1) +
  geom_point(size = 1) +
  labs(x = "", y = "Person Standardized") + 
 theme_minimal() 
```



test different windows
- 25-75 for each person and get means of PDG, and then try with other windows 
  - how many observations per person, what is the mean number of observations
  - figure out what makes sense for this dataset but tell people to look at their data 
  - give some examples of when to use categories vs continuous 

# spag plot E1G, scaled cycleday, centered on menses  

```{r}
dat.long.scz <- pivot_longer(dat, cols = c("E1G_Crtn_z", "PDG_Crtn_z", "LH_Crtn_z"), names_to = "hormone", values_to = "value")

dat.long.E1Gz.sc <- dat.long.scz %>% filter(hormone == "E1G_Crtn_z") 

dat.long.E1Gz.sc <- dat.long.E1Gz.sc[complete.cases(dat.long.E1Gz.sc [c("scaled_cycleday", "value")]),]

dat.long.E1Gz.sc %>% select(ID, scaled_cycleday, value)
dat.long.E1Gz.sc <- dat.long.E1Gz.sc %>% filter(ID!= 125)
dat.long.E1Gz.sc <- dat.long.E1Gz.sc %>% filter(ID!= 104)

dat.long.E1Gz.sc.sum <- dat.long.E1Gz.sc %>% 
  group_by(cycleday_5perc) %>% 
  summarise(mean_dev = mean(value, na.rm = TRUE), sd_dev = sd(value, na.rm = TRUE))

#dat.long.E1Gz.sc <- dat.long.E1Gz.sc %>% 
  #left_join(dat.long.E1Gz.sc.sum, by = c("cycleday_5perc"))

plot <- ggplot(dat.long.E1Gz.sc, aes(x = scaled_cycleday, y = value, group = factor(ID), color = factor(ID))) +
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf), fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf), fill = "grey87", alpha = 0.2, color = "white") +
  geom_point(size = 0.7) +
  geom_line(size = 0.7) +
  geom_line(data =dat.long.E1Gz.sc.sum, aes(x = mean_dev), color = "black", size = 1) +
   geom_errorbar(data =dat.long.E1Gz.sc.sum,
    aes(ymin = mean_dev - sd_dev, ymax = mean_dev + sd_dev, group = NA,  alpha = 0.5),
    width = 0.1,
    size = 0.1,
    color = "black"
  )+
  scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) +
  scale_color_discrete(name = "ID") +
  xlab("") +
  ylab("z-scored E1G") +
  theme_light() +
  ylim(c(-2, 4))

plot


#meanov <- dat %>% filter(ov_est == 1) %>% select(scaled_cycleday)

```

```{r}


# Add mean line with error bars using summary_data
plot +
  geom_line(
    data = dat.long.E1Gz.sc.sum,
    aes(x = cycleday_5perc, y = mean_dev),  # Ensure x and y aesthetics are properly mapped
    size = 2
  ) +
  geom_errorbar(
    data = dat.long.E1Gz.sc.sum,
    aes(x = cycleday_5perc, ymin = mean_dev - sd_dev, ymax = mean_dev + sd_dev),  # Ensure x and y aesthetics are properly mapped
    width = 0.1,
    size = 1,
    color = "black"
  )
```


# spag plot E1G, scaled cycleday impute, centered on menses  

```{r}
dat.long.scz.imp <- pivot_longer(dat, cols = c("E1G_Crtn_z", "PDG_Crtn_z", "LH_Crtn_z"), names_to = "hormone", values_to = "value")

dat.long.E1Gz.sc.imp <- dat.long.scz.imp %>% filter(hormone == "E1G_Crtn_z") 

dat.long.E1Gz.sc.imp <- dat.long.E1Gz.sc.imp[complete.cases(dat.long.E1Gz.sc.imp [c("scaled_cycleday_impute", "value")]),]

dat.long.E1Gz.sc.imp %>% select(ID, scaled_cycleday_impute, value)
dat.long.E1Gz.sc.imp <- dat.long.E1Gz.sc.imp %>% filter(ID!= 125)
dat.long.E1Gz.sc.imp <- dat.long.E1Gz.sc.imp %>% filter(ID!= 104)

ggplot(dat.long.E1Gz.sc.imp, aes(x = scaled_cycleday_impute, y = value, group = factor(ID), color = factor(ID)))+
    scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) + 
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_point(size = 0.7) +
  geom_line(size = 0.7) +
  scale_color_discrete(name = "ID") + 
   xlab("") + 
    ylab("z-scored E1G") +
  theme_light() + 
  ylim(c(-2,4))


```


```{r}
dfE1Gz <- dat.long.E1Gz.sc %>% select(ID, cycleday_5perc, value)

dfE1Gz %>%
  group_by(ID) %>%
  summarize(count = n())

```


```{r}
dat.long.scz.ov <- pivot_longer(dat, cols = c("E1G_Crtn_z", "PDG_Crtn_z", "LH_Crtn_z"), names_to = "hormone", values_to = "value")

dat.long.E1Gz.sc.ov <- dat.long.scz.ov %>% filter(hormone == "E1G_Crtn_z") 

dat.long.E1Gz.sc.ov <- dat.long.E1Gz.sc.ov[complete.cases(dat.long.E1Gz.sc.ov [c("scaled_cycleday_ov", "value")]),]

dat.long.E1Gz.sc.ov <- dat.long.E1Gz.sc.ov %>% filter(ID!= 125)
dat.long.E1Gz.sc.ov <- dat.long.E1Gz.sc.ov %>% filter(ID!= 104)


ggplot(dat.long.E1Gz.sc.ov, aes(x = scaled_cycleday_ov, y = value, group = factor(ID), color = factor(ID))) +
   scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%F", "50%F", "Ovulation", "50%L", "Menses Onset")) + 
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.94, xmax = 1, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_line(size = 0.7) +
  geom_point(size = 0.7) +
  labs(x = "", y = "z-scored E1G") + 
 theme_minimal() 
```
# spag plot E1G, scaled cycleday impute, centered on ovulation  

```{r}
dat.long.scz.ov.imp <- pivot_longer(dat, cols = c("E1G_Crtn_z", "PDG_Crtn_z", "LH_Crtn_z"), names_to = "hormone", values_to = "value")

dat.long.E1Gz.sc.ov.imp <- dat.long.scz.ov.imp %>% filter(hormone == "E1G_Crtn_z") 

dat.long.E1Gz.sc.ov.imp <- dat.long.E1Gz.sc.ov.imp[complete.cases(dat.long.E1Gz.sc.ov.imp [c("scaled_cycleday_imp_ov", "value")]),]

dat.long.E1Gz.sc.ov.imp <- dat.long.E1Gz.sc.ov.imp %>% filter(ID!= 125)
dat.long.E1Gz.sc.ov.imp <- dat.long.E1Gz.sc.ov.imp %>% filter(ID!= 104)


ggplot(dat.long.E1Gz.sc.ov.imp, aes(x = scaled_cycleday_imp_ov, y = value, group = factor(ID), color = factor(ID))) +
   scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%F", "50%F", "Ovulation", "50%L", "Menses Onset")) + 
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.94, xmax = 1, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_line(size = 0.7) +
  geom_point(size = 0.7) +
  labs(x = "", y = "z-scored E1G") + 
 theme_minimal() 
```


# spag plot PDG, scaled cycleday 

```{r}
dat.long.scz <- pivot_longer(dat, cols = c("E1G_Crtn_z", "PDG_Crtn_z", "LH_Crtn_z"), names_to = "hormone", values_to = "value")

dat.long.PDGz.sc <- dat.long.scz %>% filter(hormone == "PDG_Crtn_z") 

dat.long.PDGz.sc <- dat.long.PDGz.sc[complete.cases(dat.long.PDGz.sc [c("scaled_cycleday", "value")]),]
dat.long.PDGz.sc<- dat.long.PDGz.sc %>% filter(ID!= 125)
dat.long.PDGz.sc <- dat.long.PDGz.sc %>% filter(ID!= 104)

ggplot(dat.long.PDGz.sc, aes(x = scaled_cycleday, y = value, group = factor(ID), color = factor(ID)))+
    scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) + 
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_point(size = 1) +
  geom_line(size = 0.7) +
  scale_color_discrete(name = "ID") + 
   xlab("") + 
    ylab("z-scored PDG") +
  theme_light()


```

# spag plot PDG, scaled cycleday impute, menses centered 

```{r}
dat.long.scz <- pivot_longer(dat, cols = c("E1G_Crtn_z", "PDG_Crtn_z", "LH_Crtn_z"), names_to = "hormone", values_to = "value")

dat.long.PDGz.sc <- dat.long.scz %>% filter(hormone == "PDG_Crtn_z") 

dat.long.PDGz.sc <- dat.long.PDGz.sc[complete.cases(dat.long.PDGz.sc [c("scaled_cycleday_impute", "value")]),]
dat.long.PDGz.sc<- dat.long.PDGz.sc %>% filter(ID!= 125)
dat.long.PDGz.sc <- dat.long.PDGz.sc %>% filter(ID!= 104)

ggplot(dat.long.PDGz.sc, aes(x = scaled_cycleday_impute, y = value, group = factor(ID), color = factor(ID)))+
    scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) + 
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_point(size = 1) +
  geom_line(size = 0.7)+ 
  scale_color_discrete(name = "ID") + 
   xlab("") + 
    ylab("z-scored PDG") +
  theme_light()


```
```{r}
PDGimpute <- ggplot(dat.long.PDGz.sc, aes(x = scaled_cycleday_impute, y = value, group = factor(ID), color = factor(ID))) +
  scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) +
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf), fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf), fill = "grey87", alpha = 0.2, color = "white") +
  geom_point(size = 1) +
  geom_line(size = 0.7) +
  
  scale_color_discrete(name = "ID") +
  xlab("") +
  ylab("z-scored PDG") +
  theme_light()

PDGimpute + 
  geom_line()+
  geom_point()+
  stat_summary(fun.y=mean,geom="line",lwd=2,aes(group=1)) +
  geom_errorbar(mapping=aes(x=stage, ymin=mean-sd, ymax=mean+sd), width=0.1, size=1, color="black")

gg.spaghetti_x <-gg.spaghetti_x +geom_line() + geom_point() + ylab("X") + stat_summary(fun.y=mean,geom="line",lwd=2,aes(group=1))
gg.spaghetti_x + geom_errorbar(mapping=aes(x=stage, ymin=mean-sd, ymax=mean+sd), width=0.1, size=1, color="black")

```



```{r}
ggplot(dat.long.PDGz.sc, aes(x = cycleday_5perc, y = value, group = factor(ID), color = factor(ID))) +
  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.25), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) + 
  geom_rect(aes(xmin = 0.47, xmax = 0.53, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_point(size = 1) +
  geom_line(size = 0.7) +
  geom_text(data = dat.long.PDGz.sc %>% group_by(ID) %>% filter(cycleday_5perc ==c(0.5, 0.55, 0.6, 0.7)),
            aes(label = ID), 
            hjust = -0.1, 
            vjust = 0.5,
            size = 3) +
  scale_color_discrete(name = "ID") + 
  xlab("") + 
  ylab("z-scored PDG") +
  theme_light()
```


# spag plot PDG, scaled cycleday, centered on ovulation  

```{r}
dat.long.scz.ov <- pivot_longer(dat, cols = c("E1G_Crtn_z", "PDG_Crtn_z", "LH_Crtn_z"), names_to = "hormone", values_to = "value")

dat.long.PDGz.sc.ov <- dat.long.scz.ov %>% filter(hormone == "PDG_Crtn_z") 

dat.long.PDGz.sc.ov <- dat.long.PDGz.sc.ov[complete.cases(dat.long.PDGz.sc.ov [c("scaled_cycleday_ov", "value")]),]

dat.long.PDGz.sc.ov <- dat.long.PDGz.sc.ov %>% filter(ID!= 125)
dat.long.PDGz.sc.ov <- dat.long.PDGz.sc.ov %>% filter(ID!= 104)


ggplot(dat.long.PDGz.sc.ov, aes(x = scaled_cycleday_ov, y = value, group = factor(ID), color = factor(ID))) +
   scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%F", "50%F", "Ovulation", "50%L", "Menses Onset")) + 
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.94, xmax = 1, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_line(size = 0.7) +
  geom_point(size = 0.7) +
  labs(x = "", y = "z-scored PDG") + 
 theme_minimal() 
```

# spag plot PDG, scaled cycleday imputed, centered on ovulation  

```{r}
dat.long.scz.ov.imp <- pivot_longer(dat, cols = c("E1G_Crtn_z", "PDG_Crtn_z", "LH_Crtn_z"), names_to = "hormone", values_to = "value")

dat.long.PDGz.sc.ov.imp <- dat.long.scz.ov.imp %>% filter(hormone == "PDG_Crtn_z") 

dat.long.PDGz.sc.ov.imp <- dat.long.PDGz.sc.ov.imp[complete.cases(dat.long.PDGz.sc.ov.imp [c("scaled_cycleday_imp_ov", "value")]),]

dat.long.PDGz.sc.ov.imp <- dat.long.PDGz.sc.ov.imp %>% filter(ID!= 125)
dat.long.PDGz.sc.ov.imp <- dat.long.PDGz.sc.ov.imp %>% filter(ID!= 104)


ggplot(dat.long.PDGz.sc.ov.imp, aes(x = scaled_cycleday_imp_ov, y = value, group = factor(ID), color = factor(ID))) +
   scale_x_continuous(limits = c(-1, 1), breaks = seq(-1, 1, by = 0.5), labels = c("0%F", "50%F", "Ovulation", "50%L", "Menses Onset")) + 
  geom_rect(aes(xmin = -0.03, xmax = 0.03, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.94, xmax = 1, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_line(size = 0.7) +
  geom_point(size = 0.7) +
  labs(x = "", y = "z-scored PDG") + 
 theme_minimal() 
```


# Plotting Standard Errors 

```{r}
dat.long.sc.E1 = pivot_longer(dat, cols = c("E1G_Crtn_z.roll.d"), names_to = "hormone", values_to = "value")

dat.long.sc.E1 <- dat.long.sc.E1 %>% 
  group_by(cycleday_5perc, hormone) %>% 
  summarise(mean_dev = mean(value, na.rm = T), sd_dev = sd(value, na.rm = T)) 

ggplot(dat.long.sc.E1, aes(x = cycleday_5perc, y = mean_dev, group = hormone, color = hormone, )) +
   scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.25), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) + 
  geom_rect(aes(xmin = 0.47, xmax = 0.53, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_line(size = 1) +
  geom_point(size = 1) +
  ylim(-2, 2)+
  geom_ribbon(aes(ymin = mean_dev - sd_dev, ymax = mean_dev + sd_dev, group = NA,  alpha = 0.5)) +
  labs(x = "", y = "Person Standardized") + 
 theme_minimal() 

```


```{r}
dat.long.sc.P = pivot_longer(dat, cols = c("PDG_Crtn_z.roll.d"), names_to = "hormone", values_to = "value")

dat.long.sc.P <- dat.long.sc.P %>% 
  group_by(cycleday_5perc, hormone) %>% 
  summarise(mean_dev = mean(value, na.rm = T), sd_dev = sd(value, na.rm = T)) 

ggplot(dat.long.sc.P, aes(x = cycleday_5perc, y = mean_dev, group = hormone, color = hormone, )) +
   scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, by = 0.25), labels = c("0%L", "50%L", "Menses Onset", "50%F", "Ovulation")) + 
  geom_rect(aes(xmin = 0.47, xmax = 0.53, ymin = -Inf, ymax = Inf),
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(aes(xmin = 0.93, xmax = 0.99, ymin = -Inf, ymax = Inf),
            fill = "grey87", alpha = 0.2, color = "white") +
  geom_line(size = 1) +
  geom_point(size = 1) +
  ylim(-2, 2)+
  geom_ribbon(aes(ymin = mean_dev - sd_dev, ymax = mean_dev + sd_dev, group = NA,  alpha = 0.5)) +
  labs(x = "", y = "Person Standardized") + 
 theme_minimal() 

```


```{r}
dat.long.sc.E1 = pivot_longer(dat, cols = c("E1G_Crtn_z.roll.d"), names_to = "hormone", values_to = "value")

dat.long.sc.E1 <- dat.long.sc.E1 %>% 
  group_by(cycleday_plot, hormone) %>% 
  summarise(mean_dev = mean(value, na.rm = T),sd_dev = sd(value, na.rm = T))


ggplot(dat.long.sc.E1, aes(x = cycleday_plot, y = mean_dev, group = hormone, color = hormone)) +
   geom_rect(xmin = -0.5, xmax = 0.5, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(xmin = -15, xmax = -14, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=0, y=2, label="Menses Onset",
              color="black")+
  annotate(geom="text", x=-14, y=2, label="Ovulation",
            color="black")+
  geom_line(size = 1) +
  geom_point(size = 1) +
  geom_ribbon(aes(ymin = mean_dev - sd_dev, ymax = mean_dev + sd_dev, group = NA,  alpha = 0.5)) +
    xlab("Cycle Day (Menses Count)") + 
    ylab("Person Standardized") +
    scale_x_continuous(limits = c(-15, 12), breaks = seq(-15 ,12, by = 1), labels=c("-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13")) +
  ylim(-2, 2)+
    theme_minimal() 

```

```{r}
dat.long.sc.P = pivot_longer(dat, cols = c("PDG_Crtn_z.roll.d"), names_to = "hormone", values_to = "value")

dat.long.sc.P <- dat.long.sc.P %>% 
  group_by(cycleday_plot, hormone) %>% 
  summarise(mean_dev = mean(value, na.rm = T),sd_dev = sd(value, na.rm = T))


ggplot(dat.long.sc.P, aes(x = cycleday_plot, y = mean_dev, group = hormone, color = hormone)) +
   geom_rect(xmin = -0.5, xmax = 0.5, ymin = -Inf, ymax = Inf,
            fill = "grey70", alpha = 0.2, color = "white") +
  geom_rect(xmin = -15, xmax = -14, ymin = -Inf, ymax = Inf,
            fill = "grey87", alpha = 0.2, color = "white")+
    geom_line(size=.7,show.legend = TRUE) +
    annotate(geom="text", x=0, y=2, label="Menses Onset",
              color="black")+
  annotate(geom="text", x=-14, y=2, label="Ovulation",
            color="black")+
  geom_line(size = 1) +
  geom_point(size = 1) +
  ylim(-2, 2)+
  geom_ribbon(aes(ymin = mean_dev - sd_dev, ymax = mean_dev + sd_dev, group = NA,  alpha = 0.5)) +
    xlab("Cycle Day (Menses Count)") + 
    ylab("Person Standardized") +
    scale_x_continuous(limits = c(-15, 12), breaks = seq(-15 ,12, by = 1), labels=c("-15", "-14", "-13", "-12", "-11", "-10", "-9", "-8", "-7", "-6", "-5", "-4", "-3", "-2", "-1", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13")) +
    theme_minimal() 

```



